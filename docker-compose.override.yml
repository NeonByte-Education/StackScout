version: "3.8"

# Override configuration для локальной разработки
# Использовать: docker-compose -f docker-compose.yml -f docker-compose.override.yml up

services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: stackscout-app-dev
    ports:
      - "8081:8081"
    environment:
      - SPRING_PROFILES_ACTIVE=dev
      - LOGGING_LEVEL_COM_STACKSCOUT=DEBUG
      - SPRING_DATASOURCE_URL=jdbc:postgresql://postgres:5432/stackscout
      - SPRING_DATA_REDIS_HOST=redis
      - SPRING_RABBITMQ_HOST=rabbitmq
    volumes:
      # Синхронизация исходного кода для быстрого перезагрузки (необходимо devtools)
      - ./backend/src:/app/src
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
      rabbitmq:
        condition: service_healthy
    networks:
      - stackscout-network

  frontend:
    container_name: stackscout-frontend-dev
    environment:
      - NEXT_PUBLIC_API_URL=http://localhost:8081/api
      - NODE_ENV=development
    volumes:
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
    networks:
      - stackscout-network

  postgres:
    container_name: stackscout-postgres-dev
    volumes:
      - postgres_data_dev:/var/lib/postgresql/data
    networks:
      - stackscout-network

  redis:
    container_name: stackscout-redis-dev
    volumes:
      - redis_data_dev:/data
    networks:
      - stackscout-network

  rabbitmq:
    container_name: stackscout-rabbitmq-dev
    volumes:
      - rabbitmq_data_dev:/var/lib/rabbitmq
    networks:
      - stackscout-network

volumes:
  postgres_data_dev:
  redis_data_dev:
  rabbitmq_data_dev:

networks:
  stackscout-network:
    driver: bridge
